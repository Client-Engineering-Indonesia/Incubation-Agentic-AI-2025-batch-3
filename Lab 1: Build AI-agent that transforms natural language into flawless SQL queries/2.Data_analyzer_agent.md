# 🤖Membuat AI Agent dengan **watsonx.ai** & **LangGraph**

Pada lab ini, kita akan membuat **Data Analyzer** dengan memanfaatkan *watsonx.AI Agent Lab*. Agent ini akan menganalisis data Customer yang mengakses BTS.

> **Catatan** File‐file yang diperlukan dapat diunduh dari folder “📂 Assets”.

---

# 🧭Tahapan Pembuatan Agent

## _Step 1 — Membuat *Project*_

1. Scroll kebawah lalu buat Project baru di **Watsonx.AI** dengan menekan tombol "+".

![5.Create new Project for agent](https://github.com/Client-Engineering-Indonesia/workshop-telco-tower-ai/blob/main/Lab2-AgenticAI%20in%20watsonxAI/Assets/5.Create%20new%20Project%20for%20agent.png)

2. Menamai dan membuat project baru.

![Create a  Project](https://github.com/user-attachments/assets/1282049d-f55e-47f6-9ff9-e176dd3e4af8)

---

## 🔗 _Step 2 — Mengasosiasikan watsonx.ai Runtime_

1. Buka Halaman Project dan tekan **Manage**

![6.Press Manage](https://github.com/Client-Engineering-Indonesia/workshop-telco-tower-ai/blob/main/Lab2-AgenticAI%20in%20watsonxAI/Assets/6.Press%20Manage.png)

2. Buka **Services & Integrations → Associate Service**.

![7.Press Service Integration](https://github.com/Client-Engineering-Indonesia/workshop-telco-tower-ai/blob/main/Lab2-AgenticAI%20in%20watsonxAI/Assets/7.Press%20Service%20Integration.png)

3. Pilih **watsonx.ai** lalu kaitkan dengan project.

![9.Instance to associate](https://github.com/user-attachments/assets/3e22c81c-288c-445c-a5c8-6cffb5976012)

---

### 🗂️ _Step 3 — Menambahkan *Asset* Baru_
1. Masuk ke tab **Assets** dan klik **New Asset**.

![10.Make a New Asset](https://github.com/Client-Engineering-Indonesia/workshop-telco-tower-ai/blob/main/Lab2-AgenticAI%20in%20watsonxAI/Assets/10.Make%20a%20new%20Assets.png)

---

### 🧠 _Step 4 — Buat AI Agent_
- Klik **New Asset** di sisi kiri dan pilih **Build an AI Agent to Automate Tasks**.

![Build AI Agent](https://github.com/user-attachments/assets/c6dde849-5455-45a8-a82d-9cd11b135933)

## 📝 _Step 5 - Instruksi ke agent_

1. Click Set up lalu masukan namai agent anda sebagai "Data Analyst_your initials".

2. masukkan kalimat dibawah untuk deskripsi Agent.

```text
You are expert to query from DB2 database by converting the input by the user into SQL code for DB2 
```

- Masukkan juga **Agent instructions** yang telah tertulis dibawah.

```text
1. Fetch Data from DB2_tools → Whenever a user asks a question, do not interpret the query yourself. Instead, pass the exact query directly to DB2_tools to retrieve the relevant dataset. Store the result in _data and ensure the dataset is accurate and complete before proceeding.
```

3. Kemudian, apabila ada instruction yang lebih spesifik bisa ditambahkan juga ke dalam **Common instructions** dalam pilihan **Advance Configuration** pada pojok kanan atas.

```text
# Notes

- Use markdown syntax for formatting code snippets, links, JSON, tables, images, files.
- Any HTML tags must be wrapped in block quotes, for example ```<html>```.
- When returning code blocks, specify language.
- Sometimes, things don't go as planned. Tools may not provide useful information on the first few tries. You should always try a few different approaches before declaring the problem unsolvable.
- When the tool doesn't give you what you were asking for, you must either use another tool or a different tool input.
- When using search engines, you try different formulations of the query, possibly even in a different language.
- You cannot do complex calculations, computations, or data manipulations without using tools.
- If you need to call a tool to compute something, always call it instead of saying you will call it.


Here is how to complete your task:

1. Whenever you get the question please directly pass it to the DB2_tools. Do not interpret the question without passing it to the DB2_tools first.

```

![Agent Instruction](https://github.com/user-attachments/assets/062cc7ad-4510-4c08-91cc-9f2b0a94d64d)




## 🖥️ _Step 6 — Tambahkan Tools untuk menerjemahkan Bahasa manusia ke SQL

Sebelum menjalankan pyhton pada environment yang ada kita harus me-Deploy Python Engine.

1.  Click Deploy Python Engine.

![22. Deploy Python Engine](https://github.com/Client-Engineering-Indonesia/Incubation-Agentic-AI-2025-batch-3/blob/main/Lab%201%3A%20Build%20AI-agent%20that%20transforms%20natural%20language%20into%20flawless%20SQL%20queries/Assets/22.%20Deploy%20python%20Engine.png)

2. Click "Create" dan follow ke page berikutnya .

3. Click "Create a key" dan kembali ke halaman awal.

![23. Create Key python](https://github.com/Client-Engineering-Indonesia/Incubation-Agentic-AI-2025-batch-3/blob/main/Lab%201%3A%20Build%20AI-agent%20that%20transforms%20natural%20language%20into%20flawless%20SQL%20queries/Assets/23.create%20key%20python.png)

4. Click "Reload".

5. Buat deployment space.

![24. Create deployment space](https://github.com/Client-Engineering-Indonesia/Incubation-Agentic-AI-2025-batch-3/blob/main/Lab%201%3A%20Build%20AI-agent%20that%20transforms%20natural%20language%20into%20flawless%20SQL%20queries/Assets/24.%20create%20deployment%20space.png)

6. Isi nama untuk deployment space dan create.

- Notes : Pastikan mengaktifasi watsonx.AI Runtime pada step ini



## 🧰 _Step 7 — Tambahkan Tools untuk menerjemahkan Bahasa manusia ke SQL

Di dalam Agent lab watsonx.ai, kita dapat menambahkan tools yang sudah tersedia atau bisa mengkostumisasi tools. Tools ini dapat merubah bahasa manusia sehari hari menjadi SQL Code yang nantinya menjadi jembatan user untuk beriteraksi dengan database sebgai berikut:

## Tools di **Create custom tool**
* Scrool kebawah lalu click tombol dengan nama **"Create custom tool"**
![Add Tool](https://github.com/user-attachments/assets/74596736-0460-45b7-a394-f7323859826c)

### 1. Tool **db2tool**

- Notes: parameter dibawah dapat langsung di _copy_ dan _paste_ pada tempat seperti gambar diatas.

#### Name: ```Convert Human Language to SQL statement```
     
#### Tool description:

    
    Use this tools to convert Human Natural language to SQL statement. 
    
    
#### Input JSON Schema

```json
{
 "question": {
  "title": "query",
  "description": "Query generated from previous profiling tools that we need to pass to Db2. Make sure to pass all queries to this tool.",
  "type": "string"
 }
}
```
    
#### Python code:
    
```python
def Convert_human_language_to_sql(question):
    import ibm_db, ibm_db_dbi as dbi
    import pandas as pd
    import requests
    import ast

    #============== Token Generator =========================#
    token_url = "https://iam.cloud.ibm.com/identity/token"
    headers = {
        'Content-Type': 'application/x-www-form-urlencoded',
        'Accept': 'application/json'
    }
    data = {
        'grant_type': 'urn:ibm:params:oauth:grant-type:apikey',
        'apikey': "<API_KEY>"
    }

    response = requests.post(token_url, headers=headers, data=data, verify=False)
    iam_token = response.json().get('access_token')

    payload_headers = {
        'Content-Type': 'application/json',
        'Accept': 'application/json',
        'Authorization': f'Bearer {iam_token}'
    }

    #============== Step 1: Create Text To SQL ==============#
    texttosql_url = "https://us-south.ml.cloud.ibm.com/ml/v1/deployments/fbac0a17-36dc-44a9-b1ec-4f6111516b58/text/generation?version=2021-05-01"
    texttosql_data = {
        "parameters": {
            "prompt_variables": {
                "question": question
            }
        }
    }

    print(texttosql_data)

    texttosql_response = requests.post(texttosql_url, headers=payload_headers, json=texttosql_data)
    
    texttosql_response = texttosql_response.json()['results'][0]['generated_text']

    texttosql_response = ast.literal_eval(texttosql_response)['query']
    return texttosql_response
```

### Notes: 
Mohon ubah API key yang ada di python code dengan API yang valid yang telah diberikan oleh pihak IBM Technology.


## 🛠️ _Step 8 — Tambahkan Custom Tools untuk mengakses dan meng-query data dari DB2_tools
Pada step ini, kita hanya menggunakan custom tool dikarenakan data yang digunakan merupakan data structured yang harus dikoneksikan ke dalam DB2.
oleh karnea itu kita akan menambahkan custom tool dalam Agent lab watsonx.AI.

Dan untuk workshop kali ini kami telah menyiapkan custom tools sebagai berikut:
## Tools di **Create custom tool**
![Add Tool](https://github.com/user-attachments/assets/74596736-0460-45b7-a394-f7323859826c)

### 1. Tool **db2tool**

- Notes: parameter dibawah dapat langsung di _copy_ dan _paste_ pada tempat seperti gambar diatas.

#### Name: ```Retrieve data from DB2```
     
#### Tool description:

    
    use this tool to retrieve data from DB2 database. based on the SQL statement 
    
    
#### Input JSON Schema

```json
{
 "sql_statement": {
  "title": "sql_statement",
  "description": "SQL statement",
  "type": "string"
 }
}
```
    
#### Python code:
    
```python
def DB2_connect(sql_statement):
  import ibm_db, ibm_db_dbi as dbi
  import pandas as pd
  import requests
  import ast
  DB2_HOST = '2f3279a5-73d1-4859-88f0-a6c3e6b4b907.c3n41cmd0nqnrk39u98g.databases.appdomain.cloud'
  DB2_PORT = '30756'
  DB2_USERNAME = 'nnz83088'
  DB2_PASSWORD = '<DB Password>'
  
  db2_dsn = 'DATABASE={};HOSTNAME={};PORT={};PROTOCOL=TCPIP;UID={uid};PWD={pwd};SECURITY=SSL'.format(
      'bludb',
      DB2_HOST,
      DB2_PORT,
      uid=DB2_USERNAME,
      pwd=DB2_PASSWORD
  )

  db2_connection = dbi.connect(db2_dsn)
  answer_df = pd.read_sql_query(sql_statement, con=db2_connection)
  json_data = answer_df.to_json(orient='records')
    
    
  return json_data
```
### Notes: 
Mohon ubah DB2_PASSWORD yang ada di python code dengan password yang valid yang telah diberikan oleh pihak IBM Technology.


## ⚙️ _Step 9 — Konfigurasi Model & Parameter Agent_

Pada step ini kita dapat meng-konfiguurasi parameter dan dapat memilih untuk menggunakan model yang sesuai dengan kebutuhan kita.

Pada workshop kali ini kita akan menggunakkan settingan default yaitu dengan tidak merubah apapun.

Selanjutnya kita bisa untuk mengkonfigurasikan model dan parameter
![Add Tool](https://github.com/user-attachments/assets/3f3f10d8-d993-4694-a12c-e30b54d5b1d7)

### Konfigurasi model
  ![18. konfigurasi model](https://github.com/Client-Engineering-Indonesia/Incubation-Agentic-AI-2025-batch-3/blob/main/Lab%201%3A%20Build%20AI-agent%20that%20transforms%20natural%20language%20into%20flawless%20SQL%20queries/Assets/18.%20Konfigurasi%20parameter%20agent1.png)
  
### Konfigurasi parameter
  ![19. konfigurasi parameter](https://github.com/Client-Engineering-Indonesia/Incubation-Agentic-AI-2025-batch-3/blob/main/Lab%201%3A%20Build%20AI-agent%20that%20transforms%20natural%20language%20into%20flawless%20SQL%20queries/Assets/19.%20konfigurasi%20parameter.png)

  <img width="1237" alt="image" src="https://github.com/user-attachments/assets/6e4875be-2be3-410f-bac9-bf31c8268673" />

## 🧪 _Step 10 — Test Agent_
Coba pertanyaan berikut:
### **Natural Langguage to SQL (Data Analyzer) Agent**

- Show me the top 5 most used APIs.
- How many are the totals API calls were made?
- How many unique APIs exist in the dataset?
- What API has the most errors?
- What percentage of calls were successful?
- What is the distribution of errors across APIs?
- Make it as in percentage?
- what os A7 API Details

## 👀Step 11 — Lihat Respon Agent

![20. Test the AI Agent with the question](https://github.com/Client-Engineering-Indonesia/Incubation-Agentic-AI-2025-batch-3/blob/main/Lab%201%3A%20Build%20AI-agent%20that%20transforms%20natural%20language%20into%20flawless%20SQL%20queries/Assets/20.%20Test%20the%20agent.png)

## 💾 _Step 12 — Simpan Agent_

![Save Agent](https://github.com/user-attachments/assets/3c0363a7-cfdf-481a-b365-9ccc0fb1686e)

## 📤 _Step 13 — Export Agent_
- Simpan agent ke dalam notebook atau file yang bisa diedit untuk modifikasi selanjutnya.

![Export Agent](https://github.com/user-attachments/assets/3b1d61d0-7285-4621-88cf-8144cee6f598)
![Export Agent](https://github.com/user-attachments/assets/9f92307a-8808-449d-8bcd-3fe73d43258e)

## 🚀_Step 14 — Export Agent_
- Deploy agent agar dapat digunakan nantinya dalam bentuk API

![Export Agent](https://github.com/user-attachments/assets/3b1d61d0-7285-4621-88cf-8144cee6f598)

---

